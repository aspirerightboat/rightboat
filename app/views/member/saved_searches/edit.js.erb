$(function() {
  $('#saved_search_edit_popup').remove();
  $(document.body).append('<%= j render('form_popup') %>');
  var $popup = $('#saved_search_edit_popup');

  $popup.displayPopup();
  $('.manufacturers-picker, .models-picker', $popup).makemodelPickers();
  $('.select-currency', $popup).currencySelect();
  $('.select-general', $popup).generalSelect();

  $('.saved-multiple-country-select').each(function() {
    var $sel = $(this);
    $sel.selectize({
      render: {item: function(data, escape) {
        return '<div>' + escape(data.text.replace(/\s\(.*\)/, '')) + '</div>';
      }}
    });
    var selected_ids = $sel.data('selected-ids') || [];
    $.each(selected_ids, function() { $sel[0].selectize.addItem(this, true) });
  });

});
